---
title: "Харинаев Артём 316 группа 18.10.21"
output:
  html_document:
    df_print: paged
---

## 2.1 t-тест Стьюдента

Условия применения:

1. Сравниваемые значения не коррелируют
2. Распределение в каждой выборке - нормальное
3. Дисперсии в выборках примерно равны (для двухвыборочного критерия)

### 2.1.1

Нулевая гипотеза: среднее выборки s1 больше, чем среднее выборки s2
```{r}
s1 <- rnorm(1000, 0, 10)
s2 <- rnorm(1000, 1.5, 10 )
t.test(s1, s2, var.equal = TRUE, alternative='less')
```

p-value < 0.01, значит верна альтернативная гипотеза, что среднее выборки s2 больше, чем среднее выборки s1 (что синтетически верно)

### 2.1.2 

Нулевая гипотеза: среднее выборок s1 и s2 равно
```{r}
s1 <- rnorm(1000, 0, 10)
s2 <- rnorm(1000, 1.5, 10)
(t.test(s1, s2, var.equal = TRUE, conf.level = 0.9))
(t.test(s1, s2, var.equal = TRUE, conf.level = 0.95))
(t.test(s1, s2, var.equal = TRUE, conf.level = 0.99))
```

p-value достаточно мало, значит средние выборок не равны друг другу

при увеличении доверительного уровня увеличивается интервал

### 2.1.3 Оценка мощности критерия при заданном объеме выборки

Найдем мощность критерия сравнения средних выборок s1 и s2
```{r}
(power.t.test(n=1000, delta=1, sd=10, sig.level=0.01))
(power.t.test(n=1000, delta=1, sd=10, sig.level=0.05))
(power.t.test(n=1000, delta=1, sd=10, sig.level=0.1))
```

при увеличении уровня значимости мощность критерия также увеличивается

### 2.1.4 Оценка размера выборки при фиксированной мощности критерия

```{r}
power.t.test(delta=1, sd=10, sig.level=0.05, power=0.8)
```

для мощности критерия 80% необходима выборка большего размера (1500 элементов)

## 2.2 Уилкоксон-Манн-Уитни

Условия примененимы:

1. В каждой из выборок должно быть не менее 3 значений признака
2. В выборочных данных не должно быть совпадающих значений или таких совпадений должно быть очень мало (до 10)

нулевая гипотеза: средние выборок равны
```{r}
wilcox.test(unique(s1), unique(s2))
```

при уровне значимости 0.01 отвергаем нулевую гипотезу (что верно синтетически)

нулевая гипотеза: среднее выборки равно 0
```{r}
wilcox.test(unique(s2), mu=0)
```

p-value удовлетворяет уровню значимости 0.01, отвергаем нулевую гипотезу

## 2.3 Фишера

Условия применения:

1. нормальность распределения

нулевая гипотеза: дисперсия выборки d1 больше дисперсии выборки d2
```{r}
d1 <- rnorm(1000,0,1)
d2 <- rnorm(1000,0,1.1)
var.test(d1, d2, ratio=1, alternative='less')
```

p-value почти попадает под уровень значимости 0.05, значит отвергаем нулевую гипотезу, тогда дисперсия d1 меньше дисперсии d2 (что верно по генерированию)

## 2.4 Левене

Нулевая гипотеза: дисперсии выборок равны
```{r}
library(car)
a1 <- rnorm(1000)
a2 <- rnorm(1000, 0, 1.1)
factor1 <- as.factor(rep(1, 1000))
factor2 <- as.factor(rep(0, 1000))
leveneTest(c(a1,a2), c(factor1,factor2))
```

p-value удовлетворяет уровню значимости 0.01, отвергаем нулевую гипотезу, выборки имеют разные дисперсии

## 2.5 Бартлетта 

Условия применения:

1. нормальность данных
2. объемы выборок >3

Нулевая гипотеза: дисперсии выборок равны
```{r}
bartlett.test(c(a1, a2), c(factor1,factor2))
```

p-value удовлетворяет уровню значимости 0.01, отвергаем нулевую гипотезу, выборки имеют разные дисперсии

## 2.6 Флигнера-Килина

Нулевая гипотеза: дисперсии выборок равны
```{r}
fligner.test(c(a1, a2), c(factor1,factor2))
```

p-value удовлетворяет уровню значимости 0.01, отвергаем нулевую гипотезу, выборки имеют разные дисперсии

# 3. 

Датасет содержит наблюдения над уровнем холестерина в крови у 18-ти людей, употреблявших особый вид маргарина без транс-жиров 
```{r}
chol <- read.csv(file='..\\Cholesterol_R.csv')
```
```{r}
data <- chol[,2:4]
barplot(t(data.matrix(data)), beside=TRUE, col = rainbow(3, alpha=0.4), 
        names.arg=chol$п.їID,
        main='Уровень холестерина в крови', 
        xlab='Пациенты', ylab='Уровень холестерина')
legend('bottom', colnames(data), fill=rainbow(3, alpha=0.4))
```

Проверим нормальность данных
```{r}
library(MASS)
fit <- fitdistr(chol$Before,"normal")
mean <- fit$estimate[1]
sd <- fit$estimate[2]
ks.test(chol$Before, pnorm, mean=mean, sd=sd)
```

```{r}
fit <- fitdistr(unique(chol$After4weeks),"normal")
mean <- fit$estimate[1]
sd <- fit$estimate[2]
ks.test(unique(chol$After4weeks), pnorm, mean=mean, sd=sd)
```

```{r}
fit <- fitdistr(unique(chol$After8weeks),"normal")
mean <- fit$estimate[1]
sd <- fit$estimate[2]
ks.test(unique(chol$After8weeks), pnorm, mean=mean, sd=sd)
```

Проверим примерное равенство дисперсий выборок
```{r}
var(chol$Before)
var(chol$After4weeks)
var(chol$After8weeks)
```

Условия применнимости выполнены

Проверим гипотезу, что переход на такую диету помогает снизить холестерин

Нулевая гипотеза: среднее выборки before меньше либо равно среднему выборки after4weeks
```{r}
t.test(chol$Before, chol$After4weeks, alternative = 'greater', var.equal = TRUE)
```

При уровне значимости 0.1 нулевая гипотеза отвергается, значит переход на такую диету действительно помогает снизить уровень холестерина в крови

Оценим мощность критерия 
```{r}
power.t.test(n=18, delta=(mean(chol$Before)-mean(chol$After4weeks)), sd=sd(chol$Before), sig.level=0.1)
```


Проверим теперь, что поддержание такой диеты тоже положительно сказывается на уровне холестерина в крови

Нулевая гипотеза: среднее выборки after4weeks меньше либо равно среднему выборки after8weeks
```{r}
t.test(chol$After4weeks, chol$After8weeks, alternative = 'greater', var.equal = TRUE)
```

Результат не является статистически значимым, то есть мы не можем, опираясь на этот тест, подтвердить пользу поддержания диеты

Попробуем опровергнуть эту гипотезу с помощью критерия Уилкоскона-Манна-Уитни
```{r}
wilcox.test(unique(chol$After4weeks), unique(chol$After8weeks), 
            alternative = 'greater')
```

Данный критерий тоже не может дать статистически значимый результат

Если сравнить результаты критериев с визуализацией данных, можно сделать вывод, что критерии дают вполне логичный результат: разница между уровнем холестерина до диеты и после 4 недель значительно больше разницы между уровнями холестерина через 4 и через 8 недель

